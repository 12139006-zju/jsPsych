<!DOCTYPE html>
<html>

<head>
  <script src="../jspsych.js"></script>
  <script src="../plugins/jspsych-html-keyboard-response.js"></script>
  <script src="../plugins/jspsych-webgazer-calibrate.js"></script>
  <script src="../plugins/jspsych-webgazer-validate.js"></script>
  <script src="js/webgazer.js"></script>
  <script src="../extensions/jspsych-ext-webgazer.js"></script>
  <link rel="stylesheet" href="../css/jspsych.css">
  <style>
    .jspsych-content { max-width: 100%;}
  </style>
</head>

<body></body>

<script>

  var calibration = {
    type: 'webgazer-calibrate',
    //calibration_points: [[50,50], [25,25], [25,75], [75,25], [75,75]],
    calibration_points: [[10,10],[10,30],[10,50],[10,70],[10,90],[30,10],[30,30],[30,50],[30,70],[30,90],[50,10],[50,30],[50,50],[50,70],[50,90],[70,10],[70,30],[70,50],[70,70],[70,90],[90,10],[90,30],[90,50],[90,70],[90,90]],
    repetitions_per_point: 1,
    randomize_calibration_order: true,
    //calibration_mode: 'view',
    time_per_point: 500,
    time_to_saccade: 1000
  }

  var validation = {
    type: 'webgazer-validate',
    validation_points: [[-200,-200], [-200,200], [200,-200], [200,200]],
    validation_point_coordinates: 'center-offset-pixels',
    show_validation_data: true
  }

  var fixation = {
    type: 'html-keyboard-response',
    stimulus: '+',
    choices: jsPsych.NO_KEYS,
    trial_duration: 500    
  }

  var trial = {
    type: 'html-keyboard-response',
    stimulus: function () {
      return(
      `<div style="position: relative; width: 50vh; height: 50vh;">
        <div style="position: absolute; top:${jsPsych.timelineVariable('top', true)}%; left: ${jsPsych.timelineVariable('left', true)}%">
          <span style="font-family: monospace; font-size: 40px;">${jsPsych.timelineVariable('direction', true) == 'left' ? '<' : '>'}</span>
        </div>
      </div>`
      )
    },
    choices: ['a', 'l'],
    post_trial_gap: 250,
    extensions: ['webgazer']
  }

  var params = [
    { left: 0, top: 0, direction: 'left' },
    { left: 100, top: 0, direction: 'left' },
    { left: 0, top: 100, direction: 'left' },
    { left: 100, top: 100, direction: 'left' },
    { left: 0, top: 0, direction: 'right' },
    { left: 100, top: 0, direction: 'right' },
    { left: 0, top: 100, direction: 'right' },
    { left: 100, top: 100, direction: 'right' },
  ]

  var trial_proc = {
    timeline: [fixation, trial],
    timeline_variables: params,
    randomize_order: true
  }

  var timeline = [];
  timeline.push(calibration);
  timeline.push(validation);
  timeline.push(trial_proc);

  jsPsych.init({
    timeline: timeline,
    extensions: [
      {type: 'webgazer'}
    ]
  })
</script>

</html>